# [openGauss每日一练第 12 天-模式进阶](https://www.modb.pro/db/572971)

前面已经对模式(schema)的基本内容进行了[总结](https://www.modb.pro/db/569936)，本文在此基础上加入几个进阶的操作


## 1. 模式概念加深
openGauss的模式是对数据库做一个**逻辑分割**。所有的数据库对象都建立在模式下面。openGauss的模式和用户是**弱绑定**的，所谓的弱绑定是指虽然创建用户的同时会自动创建一个同名模式，但用户也可以单独创建模式，并且为用户指定其他的模式。

在一个数据库中，可以有多个模式。模式可以把一组对象组织在一起。这样组织机构有多少个应用，我们可以将数据库对象组织成几个模式；组织机构有几个部门，也可以为该部门创建单独的模式。默认情况下，用户将访问数据库的public模式。
> ==我的理解==：其实模式就是在一个数据库目录下创建多个子目录，实现多个用户对该数据库的访问， 常见的控制措施就是**在创建数据库的时候就给每个用户创建一个用户级的模式**， 这样每个用户在访问的时候就可以只访问自己对应的模式下的内容


## 2. public模式
openGauss在创建一个新的数据库时，会自动创建一个public模式。当用户登录到该数据库时，如果没有特殊的指定，都是操作在public模式中的数据库对象。
默认情况下，**用户新创建的表，位于public模式中**
数据库创建初始，默认具有一个名为public的Schema，且所有用户都拥有此Schema的usage权限，**只有系统管理员和初始化用户可以在public Schema下创建函数、存储过程和同义词对象**，其他用户即使赋予create权限后也不可以创建上述三种对象。Schema类似于操作系统目录，**但Schema不能嵌套**。默认只有初始化用户可以在**pg_catalog**模式下创建对象。
  
## ==3.会话级，用户级，数据库级模式==
这就解释了之前在课堂实验使为什么一直要重新设置搜索路径的问题：因为我一直设置的是会话级模式，如果发生断连后就需要重新设置

- **会话级设置模式搜索顺序**
在gsql客户端会话中，执行命令SET SEARCH_PATH TO schm1可以修改模式搜索路径，**但只在gsql客户端会话的持续过程中起作用**，一旦退出gsql客户端会话，这个设置就丢失了。**重新登录gsql会话将模式搜索路径恢复为默认值"$user",public**。
```sql
set search_path to schema1,public;
```
- **数据库级设置模式搜索顺序**
<font color=red>修改数据库级别的搜索顺序后，数据库用户user1再次登录到数据库enmdb，其模式搜索路径已经变更为数据库默认的模式搜索路径schm1。</font>
```sql
alter database endb set search_path to schema2;
```
- **用户级设置模式搜索顺序**
当以特定用户登录数据库时，模式自动变为了用户级设置的模式
```sql
alter user user1 set search_path to schema3;
```

- **搜索顺序的优先级**
会话级模式搜索顺序的优先级最高，用户级模式搜索顺序的优先级第2，数据库级模式搜索顺序的优先级最低。

## 4.每日sql语句
复习，用简单指令查看数据库集簇的各种对象
```sql
\db+ 表空间
\l+ 数据库
\du+ 用户
\dn+ 模式
\dt+ 表
\di 索引
-- 这些命令后都可以加具体的对象名，查看其信息
```


